{% extends 'base.html' %}
{% load static %}

{% block title %}Photo Gallery - Shuttrly{% endblock %}

{% block head %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'css/photo_gallery.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Gallery Header -->
    <div class="">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="gallery-title">
                    <i class="fas fa-images"></i>
                    My Photos
                </h1>
                <div class="gallery-stats">
                    <span class="stat-item">
                        <i class="fas fa-camera"></i>
                        {{ total_photos }} photos
                    </span>
                    <span class="stat-item">
                        <i class="fas fa-film"></i>
                        {{ raw_photos }} RAW
                    </span>
                    <span class="stat-item">
                        <i class="fas fa-globe"></i>
                        {{ public_photos }} public
                    </span>
                </div>
            </div>
            <div class="col-lg-4 text-end">
                <a href="{% url 'photos:upload' %}" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Upload Photos
                </a>
            </div>
        </div>
    </div>

    <!-- Search and Filters -->
    <div class="search-filters mb-4">
        <div class="card">
            <div class="card-body">
                <form method="get" class="row g-3">
                    <div class="col-md-4">
                        <input type="text" 
                               name="query" 
                               class="form-control" 
                               placeholder="Search photos..."
                               value="{{ search_form.query.value|default:'' }}">
                    </div>
                    <div class="col-md-2">
                        <select name="camera_make" class="form-select">
                            <option value="">All Cameras</option>
                            {% for camera_make in cameras %}
                                <option value="{{ camera_make }}" 
                                        {% if search_form.camera_make.value == camera_make %}selected{% endif %}>
                                    {{ camera_make }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-2">
                        <select name="is_raw" class="form-select">
                            <option value="">All Formats</option>
                            <option value="true" {% if search_form.is_raw.value == 'true' %}selected{% endif %}>RAW Only</option>
                            <option value="false" {% if search_form.is_raw.value == 'false' %}selected{% endif %}>JPEG Only</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-outline-primary w-100">
                            <i class="fas fa-search"></i> Search
                        </button>
                    </div>
                    <div class="col-md-2">
                        <a href="{% url 'photos:gallery' %}" class="btn btn-outline-secondary w-100">
                            <i class="fas fa-times"></i> Clear
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Gallery Grid -->
    <div class="gallery-container">
        <div class="masonry-grid" id="masonry-grid">
            {% for photo in page_obj %}
            <div class="photo-item" data-photo-id="{{ photo.id }}">
                <div class="photo-wrapper">
                    <img src="{{ photo.thumbnail.url|default:photo.original_file.url }}" 
                         alt="{{ photo.title|default:'Untitled' }}"
                         class="photo-image"
                         loading="lazy"
                         data-original="{{ photo.original_file.url }}"
                         data-title="{{ photo.title|default:'Untitled' }}"
                         data-description="{{ photo.description|default:'' }}"
                         data-iso="{{ photo.iso|default:'N/A' }}"
                         data-shutter="{{ photo.shutter_speed|default:'N/A' }}"
                         data-aperture="{{ photo.aperture|default:'N/A' }}"
                         data-camera="{{ photo.camera_make|default:'' }} {{ photo.camera_model|default:'' }}"
                         data-lens="{{ photo.lens_model|default:'N/A' }}"
                         data-date="{{ photo.date_taken|date:'M d, Y'|default:photo.created_at|date:'M d, Y' }}">
                    
                    <!-- Hover Overlay -->
                    <div class="photo-overlay">
                        <div class="overlay-header">
                            <div class="exposure-info">
                                <div class="exposure-item">
                                    <span class="label">ISO</span>
                                    <span class="value">{{ photo.iso|default:'N/A' }}</span>
                                </div>
                                <div class="exposure-item">
                                    <span class="label">Shutter</span>
                                    <span class="value">{{ photo.shutter_speed|default:'N/A' }}</span>
                                </div>
                                <div class="exposure-item">
                                    <span class="label">Aperture</span>
                                    <span class="value">{{ photo.aperture|default:'N/A' }}</span>
                                </div>
                            </div>
                            <div class="shadow-header"></div>
                        </div>
                        <div class="overlay-footer">
                            <div class="shadow-footer"></div>
                            <div class="photo-info">
                                <div class="photo-actions">
                                    <a href="{% url 'photos:detail' photo.id %}" class="btn btn-sm btn-outline-light">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="{% url 'photos:edit' photo.id %}" class="btn btn-sm btn-outline-light">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <button class="btn btn-sm btn-outline-light delete-photo" data-photo-id="{{ photo.id }}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- RAW Badge -->
                    {% if photo.is_raw %}
                    <div class="raw-badge">
                        <i class="fas fa-film"></i> RAW
                    </div>
                    {% endif %}

                    <!-- Public Badge -->
                    {% if photo.is_public %}
                    <div class="public-badge">
                        <i class="fas fa-globe"></i>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% empty %}
            <div class="empty-gallery">
                <div class="empty-content">
                    <i class="fas fa-images fa-3x text-muted mb-3"></i>
                    <h4>No photos yet</h4>
                    <p class="text-muted">Start building your photo collection by uploading your first photo.</p>
                    <a href="{% url 'photos:upload' %}" class="btn btn-primary">
                        <i class="fas fa-upload"></i> Upload Photos
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Pagination -->
    {% if page_obj.has_other_pages %}
    <div class="pagination-container">
        <nav aria-label="Photo gallery pagination">
            <ul class="pagination justify-content-center">
                {% if page_obj.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page=1{% if request.GET.query %}&query={{ request.GET.query }}{% endif %}{% if request.GET.camera_make %}&camera_make={{ request.GET.camera_make }}{% endif %}{% if request.GET.is_raw %}&is_raw={{ request.GET.is_raw }}{% endif %}">
                            <i class="fas fa-angle-double-left"></i>
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if request.GET.query %}&query={{ request.GET.query }}{% endif %}{% if request.GET.camera_make %}&camera_make={{ request.GET.camera_make }}{% endif %}{% if request.GET.is_raw %}&is_raw={{ request.GET.is_raw }}{% endif %}">
                            <i class="fas fa-angle-left"></i>
                        </a>
                    </li>
                {% endif %}

                {% for num in page_obj.paginator.page_range %}
                    {% if page_obj.number == num %}
                        <li class="page-item active">
                            <span class="page-link">{{ num }}</span>
                        </li>
                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ num }}{% if request.GET.query %}&query={{ request.GET.query }}{% endif %}{% if request.GET.camera_make %}&camera_make={{ request.GET.camera_make }}{% endif %}{% if request.GET.is_raw %}&is_raw={{ request.GET.is_raw }}{% endif %}">{{ num }}</a>
                        </li>
                    {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if request.GET.query %}&query={{ request.GET.query }}{% endif %}{% if request.GET.camera_make %}&camera_make={{ request.GET.camera_make }}{% endif %}{% if request.GET.is_raw %}&is_raw={{ request.GET.is_raw }}{% endif %}">
                            <i class="fas fa-angle-right"></i>
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.query %}&query={{ request.GET.query }}{% endif %}{% if request.GET.camera_make %}&camera_make={{ request.GET.camera_make }}{% endif %}{% if request.GET.is_raw %}&is_raw={{ request.GET.is_raw }}{% endif %}">
                            <i class="fas fa-angle-double-right"></i>
                        </a>
                    </li>
                {% endif %}
            </ul>
        </nav>
    </div>
    {% endif %}
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deletePhotoModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Photo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this photo? This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDelete">Delete</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ block.super }}
<script src="{% static 'js/photo_gallery.js' %}"></script>
{% endblock %}
