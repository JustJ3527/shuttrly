<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test des Modules JavaScript - Shuttrly</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .test-section {
            margin: 2rem 0;
            padding: 1.5rem;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
        }
        .test-result {
            margin: 0.5rem 0;
            padding: 0.5rem;
            border-radius: 0.25rem;
        }
        .test-success { background-color: #d1e7dd; color: #0f5132; }
        .test-error { background-color: #f8d7da; color: #721c24; }
        .test-warning { background-color: #fff3cd; color: #856404; }
        .countdown-display {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin: 1rem 0;
        }
        .form-test {
            max-width: 400px;
            margin: 1rem 0;
        }
        .ui-demo {
            margin: 1rem 0;
            padding: 1rem;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">üß™ Test des Modules JavaScript - Shuttrly</h1>
        
        <!-- Configuration Test -->
        <div class="test-section">
            <h3>üîß Test de Configuration</h3>
            <div id="config-test-results"></div>
            <button class="btn btn-primary" onclick="testConfiguration()">Tester la Configuration</button>
        </div>

        <!-- UI Utils Test -->
        <div class="test-section">
            <h3>üé® Test des Utilitaires UI</h3>
            <div id="ui-test-results"></div>
            <div class="ui-demo">
                <button class="btn btn-success" onclick="testUIUtils()">Tester les Utilitaires UI</button>
                <button class="btn btn-info" onclick="testAnimations()">Tester les Animations</button>
                <button class="btn btn-warning" onclick="testPasswordToggle()">Tester Password Toggle</button>
            </div>
            <div id="ui-demo-area"></div>
        </div>

        <!-- Form Validation Test -->
        <div class="test-section">
            <h3>‚úÖ Test de Validation des Formulaires</h3>
            <div id="validation-test-results"></div>
            <div class="form-test">
                <form id="test-form">
                    <div class="mb-3">
                        <label for="test-username" class="form-label">Nom d'utilisateur</label>
                        <input type="text" class="form-control" id="test-username" name="username" required>
                    </div>
                    <div class="mb-3">
                        <label for="test-password" class="form-label">Mot de passe</label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="test-password" name="password" required>
                            <button class="btn btn-outline-secondary password-toggle-icon" type="button">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="test-email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="test-email" name="email" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Tester la Validation</button>
                </form>
            </div>
        </div>

        <!-- Countdown Test -->
        <div class="test-section">
            <h3>‚è∞ Test des Countdowns</h3>
            <div id="countdown-test-results"></div>
            <div class="countdown-display">
                <div id="countdown" data-countdown-type="email" data-time-until-resend="30" data-can-resend="false">
                    Temps restant: <span id="timer">30</span> secondes
                </div>
                <div id="resend-form" style="display: none;">
                    <button class="btn btn-primary">Renvoyer le code</button>
                </div>
            </div>
            <button class="btn btn-success" onclick="testCountdown()">Tester les Countdowns</button>
        </div>

        <!-- 2FA Test -->
        <div class="test-section">
            <h3>üîê Test de la 2FA</h3>
            <div id="2fa-test-results"></div>
            <div class="ui-demo">
                <button class="btn btn-primary" onclick="test2FAFunctions()">Tester les Fonctions 2FA</button>
                <button class="btn btn-success" onclick="testTOTPCopy()">Tester la Copie TOTP</button>
            </div>
            <div id="2fa-demo-area"></div>
        </div>

        <!-- Authentication Test -->
        <div class="test-section">
            <h3>üîë Test de l'Authentification</h3>
            <div id="auth-test-results"></div>
            <button class="btn btn-primary" onclick="testAuthentication()">Tester l'Authentification</button>
        </div>

        <!-- Global Test -->
        <div class="test-section">
            <h3>üåê Test Global</h3>
            <div id="global-test-results"></div>
            <button class="btn btn-success" onclick="runAllTests()">Lancer Tous les Tests</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="config.js"></script>
    <script src="ui-utils.js"></script>
    <script src="form-validation.js"></script>
    <script src="countdown.js"></script>
    <script src="2fa.js"></script>
    <script src="auth-modern.js"></script>

    <script>
        // Test Functions
        function testConfiguration() {
            const results = document.getElementById('config-test-results');
            results.innerHTML = '';
            
            try {
                // Test basic configuration
                const config = window.SHUTTRLY_CONFIG;
                if (!config) throw new Error('Configuration not loaded');
                
                // Test configuration values
                const uiDuration = config.get('ui.animation.duration');
                const passwordLength = config.get('validation.password.minLength');
                const countdownDelay = config.get('countdown.email.resendDelay');
                
                if (uiDuration !== 300) throw new Error('UI animation duration incorrect');
                if (passwordLength !== 8) throw new Error('Password min length incorrect');
                if (countdownDelay !== 60) throw new Error('Countdown delay incorrect');
                
                addTestResult(results, 'Configuration charg√©e et valid√©e', 'success');
                addTestResult(results, `UI Duration: ${uiDuration}ms`, 'success');
                addTestResult(results, `Password Min Length: ${passwordLength}`, 'success');
                addTestResult(results, `Countdown Delay: ${countdownDelay}s`, 'success');
                
            } catch (error) {
                addTestResult(results, `Erreur de configuration: ${error.message}`, 'error');
            }
        }

        function testUIUtils() {
            const results = document.getElementById('ui-test-results');
            results.innerHTML = '';
            
            try {
                if (!window.uiUtils) throw new Error('UI Utils not loaded');
                
                // Test element creation
                const testElement = window.uiUtils.createElement('div', { className: 'test-div' }, 'Test Element');
                if (!testElement) throw new Error('Element creation failed');
                
                // Test fade in
                const demoArea = document.getElementById('ui-demo-area');
                demoArea.innerHTML = '';
                demoArea.appendChild(testElement);
                
                window.uiUtils.fadeIn(testElement);
                
                addTestResult(results, 'UI Utils charg√© avec succ√®s', 'success');
                addTestResult(results, 'Cr√©ation d\'√©l√©ment test√©e', 'success');
                addTestResult(results, 'Animation fade-in test√©e', 'success');
                
            } catch (error) {
                addTestResult(results, `Erreur UI Utils: ${error.message}`, 'error');
            }
        }

        function testAnimations() {
            const results = document.getElementById('ui-test-results');
            const demoArea = document.getElementById('ui-demo-area');
            
            // Create test elements
            const elements = [];
            for (let i = 0; i < 3; i++) {
                const element = window.uiUtils.createElement('div', { 
                    className: 'alert alert-info m-2' 
                }, `Animation Test ${i + 1}`);
                elements.push(element);
                demoArea.appendChild(element);
            }
            
            // Test staggered animations
            window.uiUtils.toggleElements(elements, true, { stagger: 200 });
            
            addTestResult(results, 'Animations en cascade test√©es', 'success');
        }

        function testPasswordToggle() {
            const results = document.getElementById('ui-test-results');
            
            try {
                // Initialize password toggles
                window.uiUtils.initializePasswordToggles();
                addTestResult(results, 'Password toggles initialis√©s', 'success');
                
            } catch (error) {
                addTestResult(results, `Erreur password toggle: ${error.message}`, 'error');
            }
        }

        function testCountdown() {
            const results = document.getElementById('countdown-test-results');
            results.innerHTML = '';
            
            try {
                if (!window.countdownManager) throw new Error('Countdown Manager not loaded');
                
                // Test countdown initialization
                const countdownElement = document.getElementById('countdown');
                const timerElement = document.getElementById('timer');
                const resendForm = document.getElementById('resend-form');
                
                window.countdownManager.initializeEmailCountdown({
                    timeUntilResend: 30,
                    timerId: 'timer',
                    countdownId: 'countdown',
                    resendFormId: 'resend-form',
                    canResend: false
                });
                
                addTestResult(results, 'Countdown Manager charg√© avec succ√®s', 'success');
                addTestResult(results, 'Countdown email initialis√©', 'success');
                addTestResult(results, 'Timer d√©marr√© (30 secondes)', 'success');
                
            } catch (error) {
                addTestResult(results, `Erreur Countdown: ${error.message}`, 'error');
            }
        }

        function test2FAFunctions() {
            const results = document.getElementById('2fa-test-results');
            results.innerHTML = '';
            
            try {
                if (!window.twoFactorAuth) throw new Error('2FA System not loaded');
                
                // Test 2FA functions
                const functions = [
                    'showEnableEmail2FA',
                    'hideEnableEmail2FA',
                    'showEnableTOTP2FA',
                    'toggleDeviceDetails'
                ];
                
                functions.forEach(funcName => {
                    if (typeof window[funcName] === 'function') {
                        addTestResult(results, `${funcName}: Disponible`, 'success');
                    } else {
                        addTestResult(results, `${funcName}: Manquant`, 'error');
                    }
                });
                
                addTestResult(results, 'Syst√®me 2FA charg√© avec succ√®s', 'success');
                
            } catch (error) {
                addTestResult(results, `Erreur 2FA: ${error.message}`, 'error');
            }
        }

        function testTOTPCopy() {
            const results = document.getElementById('2fa-test-results');
            const demoArea = document.getElementById('2fa-demo-area');
            
            // Create demo TOTP elements
            demoArea.innerHTML = `
                <div class="mt-3">
                    <button id="copyTotpUriBtn" class="btn btn-info">Copier URI TOTP</button>
                    <input type="text" id="totpUriInput" value="otpauth://totp/Test:user@example.com?secret=JBSWY3DPEHPK3PXP&issuer=Test" readonly style="position: absolute; left: -9999px;">
                    <span id="copyMessage" style="color: green; display: none;">Copi√© !</span>
                </div>
            `;
            
            // Initialize TOTP copy functionality
            window.twoFactorAuth.initializeTOTPCopy();
            
            addTestResult(results, 'Fonctionnalit√© TOTP copy initialis√©e', 'success');
        }

        function testAuthentication() {
            const results = document.getElementById('auth-test-results');
            results.innerHTML = '';
            
            try {
                if (!window.modernAuth) throw new Error('Modern Auth not loaded');
                
                addTestResult(results, 'Syst√®me d\'authentification moderne charg√©', 'success');
                addTestResult(results, `Page d√©tect√©e: ${window.modernAuth.currentPage}`, 'success');
                addTestResult(results, `√âtape d√©tect√©e: ${window.modernAuth.currentStep}`, 'success');
                
            } catch (error) {
                addTestResult(results, `Erreur Authentification: ${error.message}`, 'error');
            }
        }

        function runAllTests() {
            const results = document.getElementById('global-test-results');
            results.innerHTML = '';
            
            addTestResult(results, 'üöÄ Lancement de tous les tests...', 'warning');
            
            // Run all tests with delay
            setTimeout(() => testConfiguration(), 100);
            setTimeout(() => testUIUtils(), 200);
            setTimeout(() => testCountdown(), 300);
            setTimeout(() => test2FAFunctions(), 400);
            setTimeout(() => testAuthentication(), 500);
            
            setTimeout(() => {
                addTestResult(results, '‚úÖ Tous les tests ont √©t√© lanc√©s', 'success');
                addTestResult(results, 'V√©rifiez les r√©sultats de chaque section', 'info');
            }, 600);
        }

        function addTestResult(container, message, type) {
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result test-${type}`;
            resultDiv.innerHTML = message;
            container.appendChild(resultDiv);
        }

        // Initialize form validation test
        document.addEventListener('DOMContentLoaded', () => {
            const testForm = document.getElementById('test-form');
            if (testForm && window.formValidator) {
                window.formValidator.initializeFormValidation('test-form', {
                    'username': [{ type: 'required' }, { type: 'username' }],
                    'password': [{ type: 'required' }, { type: 'password' }],
                    'email': [{ type: 'required' }, { type: 'email' }]
                }, {
                    onSubmit: (form, validationResult) => {
                        const results = document.getElementById('validation-test-results');
                        results.innerHTML = '';
                        
                        if (validationResult.isValid) {
                            addTestResult(results, '‚úÖ Formulaire valid√© avec succ√®s !', 'success');
                        } else {
                            addTestResult(results, '‚ùå Erreurs de validation d√©tect√©es', 'error');
                        }
                        
                        return false; // Prevent actual submission
                    }
                });
            }
        });
    </script>
</body>
</html>