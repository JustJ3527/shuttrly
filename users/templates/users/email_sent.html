{% extends 'base.html' %}
{% load static %}
{% block content %}
  <h2>Verify your email</h2>
  <p>We sent a verification email to your address.</p>

  <div id="cooldown-message">
    {% if cooldown_remaining > 0 %}
      <p>You can resend the email in <span id="cooldown">{{ cooldown_remaining }}</span> seconds.</p>
    {% else %}
      <button id="resend-button">Resend verification email</button>
    {% endif %}
  </div>

  <script>
    const resendButton = document.getElementById('resend-button');
    const cooldownSpan = document.getElementById('cooldown');

    if (resendButton) {
      resendButton.addEventListener('click', function () {
        fetch("{% url 'resend_verification_email' %}")
          .then(response => response.json())
          .then(data => {
            if (data.status === 'sent') {
              alert('Verification email resent!');
              location.reload();
            } else if (data.status === 'cooldown') {
              alert('Please wait before resending.');
            } else if (data.status === 'already_verified') {
              alert('Your email is already verified.');
            }
          });
      });
    }

    if (cooldownSpan) {
      let seconds = parseInt(cooldownSpan.innerText);
      setInterval(() => {
        if (seconds > 0) {
          seconds--;
          cooldownSpan.innerText = seconds;
        } else {
          location.reload();
        }
      }, 1000);
    }
  </script>
{% endblock %}